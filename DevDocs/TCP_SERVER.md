# TCP Server 功能说明

## 概述

基于现有的 WebSocket 服务器实现，我新增了完整的 TCP 服务器功能。TCP 服务器支持多客户端连接、消息广播、以及文本和十六进制数据传输。

## 主要功能

### 1. TCP 服务器管理
- **启动/停止服务器**: 支持在指定主机和端口上启动TCP服务器
- **服务器状态监控**: 实时显示服务器运行状态和客户端连接数
- **多服务器实例**: 支持同时运行多个不同端口的TCP服务器

### 2. 客户端连接管理
- **自动连接管理**: 自动为每个连接的客户端分配唯一ID
- **连接状态跟踪**: 实时监控客户端连接和断开事件
- **连接数统计**: 显示当前连接的客户端数量

### 3. 消息传输
- **文本消息**: 支持发送和接收UTF-8编码的文本消息
- **十六进制数据**: 支持发送和接收二进制数据（以十六进制形式显示）
- **消息广播**: 支持向所有连接的客户端广播消息
- **单客户端发送**: 支持向指定客户端发送消息

### 4. 用户界面
- **直观的界面**: 类似于WebSocket服务器的界面设计
- **实时消息日志**: 显示所有连接事件和收发的消息
- **消息类型选择**: 可选择发送文本或十六进制格式的消息
- **配置持久化**: 自动保存服务器配置到本地存储

## 技术实现

### 后端 (Rust)
- **异步TCP服务器**: 使用 `tokio::net::TcpListener` 实现高性能异步TCP服务器
- **并发连接处理**: 每个客户端连接在独立的异步任务中处理
- **生命周期管理**: 实现完整的连接生命周期管理和资源清理
- **事件系统**: 通过Tauri事件系统向前端发送实时更新

### 前端 (Blazor)
- **响应式UI**: 使用BootstrapBlazor组件构建现代化界面
- **实时更新**: 通过Tauri事件监听器实现实时UI更新
- **配置管理**: 使用LocalStorage持久化用户配置
- **国际化支持**: 支持中英文界面

## 使用方法

### 1. 启动TCP服务器
1. 在应用程序中切换到"TCP Server"标签页
2. 设置主机地址（默认：127.0.0.1）和端口（默认：8081）
3. 点击"启动"按钮启动服务器
4. 服务器状态会显示为"Running"，并分配一个唯一的服务器ID

### 2. 连接客户端
可以使用任何TCP客户端连接到服务器，例如：
- telnet 127.0.0.1 8081
- nc 127.0.0.1 8081
- 使用提供的Python测试客户端：`python tcp_test_client.py 127.0.0.1 8081`

### 3. 发送消息
1. 在"消息类型"中选择"Text"或"Hex"
2. 在发送框中输入消息内容
3. 点击发送按钮广播消息给所有连接的客户端

### 4. 监控连接和消息
- 所有客户端连接/断开事件会显示在消息日志中
- 收到的消息会实时显示在消息日志中
- 客户端连接数会实时更新

## 测试TCP服务器

### 使用Python测试客户端
```bash
# 基本连接测试
python tcp_test_client.py

# 连接到特定地址和端口
python tcp_test_client.py 192.168.1.100 9999

# 交互式发送消息
# 输入文本消息直接发送
# 输入 hex:41424344 发送十六进制数据
# 输入 quit 退出
```

### 使用telnet测试
```bash
telnet 127.0.0.1 8081
```

### 使用PowerShell测试
```powershell
$client = New-Object System.Net.Sockets.TcpClient
$client.Connect("127.0.0.1", 8081)
$stream = $client.GetStream()
$data = [System.Text.Encoding]::UTF8.GetBytes("Hello from PowerShell!")
$stream.Write($data, 0, $data.Length)
$client.Close()
```

## 配置选项

### 服务器配置
- **主机地址**: 服务器绑定的IP地址（默认：127.0.0.1）
- **端口**: 服务器监听的端口（默认：8081）
- **服务器ID**: 自动生成的唯一标识符

### 消息配置
- **最大条目数**: 消息日志显示的最大条目数
- **自动换行**: 长消息是否自动换行显示
- **消息类型**: 发送消息的格式（文本/十六进制）

## API 命令

TCP服务器实现了以下Tauri命令：

### 服务器管理
- `start_tcp_server`: 启动TCP服务器
- `stop_tcp_server`: 停止TCP服务器  
- `get_tcp_servers`: 获取所有TCP服务器列表
- `get_tcp_server_info`: 获取特定TCP服务器信息

### 消息发送
- `send_tcp_message`: 发送消息到TCP客户端

### 事件
- `tcp-server-event`: TCP服务器事件（连接、断开、消息接收）

## 错误处理

系统实现了完善的错误处理机制：
- 网络连接错误
- 数据格式错误
- 服务器启动失败
- 客户端断开异常

所有错误都会在UI中显示用户友好的错误消息，并记录到控制台用于调试。

## 性能考虑

- 使用异步I/O确保高并发性能
- 实现了连接池和资源自动清理
- 消息缓冲区大小为1024字节，可根据需要调整
- 支持同时处理数百个并发连接

## 开发说明

TCP服务器的实现完全参照了现有的WebSocket服务器架构：
- 相同的管理器模式
- 相同的事件驱动架构  
- 相同的UI组件结构
- 相同的配置管理方式

这确保了代码的一致性和可维护性。
